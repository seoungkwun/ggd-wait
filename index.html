<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ê²½ê¸°ë„ ì¥ì• ì¸ì½œ ëŒ€ê¸°í˜„í™©</title>
  <style>
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;overflow-x:hidden;background:#111;color:#fff;font-family:Arial,sans-serif}
    header{padding:10px 8px;text-align:center;font-size:26px;font-weight:800}
    .ver{margin-top:2px;text-align:center;font-size:12px;color:#9aa0a6}
    .topbar{display:flex;justify-content:center;gap:10px;align-items:center;margin:10px 0 2px}
    button{padding:8px 18px;font-size:18px;cursor:pointer;border:1px solid #666;background:#2a2a2a;color:#fff;border-radius:6px}
    #time{margin:4px 0 0;text-align:center;font-size:17px;color:#cfcfcf}
    #status{margin:6px 0 8px;text-align:center;font-size:14px;color:#ff6b6b;min-height:18px}
    .container{display:flex;gap:6px;padding:6px}
    .col{width:50%;background:#161616;border:1px solid #333;border-radius:8px;padding:6px}
    h2{margin:0 0 6px;text-align:center;font-size:19px}
    table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:20px}
    th,td{border:1px solid #3f3f3f;text-align:center;padding:2px 0;white-space:nowrap;line-height:1.35}
    th{background:#222;font-size:20px}
    th:nth-child(1), td:nth-child(1){width:42%}
    th:nth-child(2), td:nth-child(2){width:16%}
    th:nth-child(3), td:nth-child(3){width:16%}
    @media (max-width: 900px){
      header{font-size:22px}
      table, th{font-size:18px}
      .container{gap:4px;padding:4px}
      .col{padding:4px}
      th,td{padding:2px 0}
    }
  </style>
</head>
<body>
  <header>ê²½ê¸°ë„ ì¥ì• ì¸ì½œ ëŒ€ê¸°í˜„í™©</header>
  <div class="ver">ë²„ì „: 2026-02-14 (Vercel /api í”„ë¡ì‹œ ì‚¬ìš©)</div>

  <div class="topbar">
    <button id="reloadBtn" type="button">ğŸ” ìƒˆë¡œê³ ì¹¨</button>
  </div>
  <div id="time"></div>
  <div id="status"></div>

  <div class="container">
    <div class="col">
      <h2>ì‹œêµ° ëª©ë¡ (1ì—´)</h2>
      <table>
        <thead><tr><th>ì‹œêµ°ëª…</th><th>ìš´í–‰</th><th>ëŒ€ê¸°</th></tr></thead>
        <tbody id="left"></tbody>
      </table>
    </div>
    <div class="col">
      <h2>ì‹œêµ° ëª©ë¡ (2ì—´)</h2>
      <table>
        <thead><tr><th>ì‹œêµ°ëª…</th><th>ìš´í–‰</th><th>ëŒ€ê¸°</th></tr></thead>
        <tbody id="right"></tbody>
      </table>
    </div>
  </div>

<script>
  // ê¸°ì¡´ ìš°ì„ í‘œì‹œ(ê³ ì • ìˆœì„œ)
  const PRIORITY = ["ì˜ì •ë¶€ì‹œ","ì–‘ì£¼ì‹œ","ë™ë‘ì²œì‹œ","í¬ì²œì‹œ","ë‚¨ì–‘ì£¼ì‹œ","ì—°ì²œêµ°","ê³ ì–‘ì‹œ","íŒŒì£¼ì‹œ"];

  function setStatus(msg){ document.getElementById("status").innerText = msg || ""; }
  function setTime(){ document.getElementById("time").innerText = "ì¡°íšŒ ì‹œê°: " + new Date().toLocaleString("ko-KR"); }

  function render(id, rows){
    const el = document.getElementById(id);
    if(!rows || !rows.length){
      el.innerHTML = "<tr><td colspan='3'>-</td></tr>";
      return;
    }
    el.innerHTML = rows.map(r =>
      `<tr><td>${r.NAME}</td><td>${Number(r.CAR_CNT).toLocaleString("ko-KR")}</td><td>${Number(r.REQ_CNT).toLocaleString("ko-KR")}</td></tr>`
    ).join("");
  }

  async function loadData(){
    setStatus("ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...");
    document.getElementById("left").innerHTML = "<tr><td colspan='3'>ë¡œë”©ì¤‘...</td></tr>";
    document.getElementById("right").innerHTML = "<tr><td colspan='3'>...</td></tr>";

    try{
      const res = await fetch("/api/waitinfo", { cache: "no-store" });
      const data = await res.json();

      if(!res.ok){
        throw new Error(data?.error || ("HTTP " + res.status));
      }

      if(!Array.isArray(data)){
        throw new Error("ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜(ë°°ì—´ ì•„ë‹˜)");
      }

      const list = data;

      // ìš°ì„ ì§€ì—­ì€ ê³ ì • ìˆœì„œë¡œ ìœ„ì—
      const fixed = list
        .filter(x => PRIORITY.includes(x.NAME))
        .sort((a,b) => PRIORITY.indexOf(a.NAME) - PRIORITY.indexOf(b.NAME));

      // ë‚˜ë¨¸ì§€ëŠ” ê°€ë‚˜ë‹¤ìˆœ(ê¸°ì¡´ ë°©ì‹ ìœ ì§€)
      const others = list
        .filter(x => !PRIORITY.includes(x.NAME))
        .sort((a,b) => String(a.NAME).localeCompare(String(b.NAME), "ko"));

      const finalList = [...fixed, ...others];

      const mid = Math.ceil(finalList.length/2);
      render("left", finalList.slice(0, mid));
      render("right", finalList.slice(mid));

      setStatus("");
      setTime();
    }catch(e){
      setStatus("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: " + (e?.message || e));
      render("left", []);
      render("right", []);
      console.error(e);
    }
  }

  document.getElementById("reloadBtn").addEventListener("click", loadData);
  loadData();
</script>
</body>
</html>
