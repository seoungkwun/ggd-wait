<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ê²½ê¸°ë„ ì¥ì• ì¸ì½œ ëŒ€ê¸°í˜„í™©</title>

<style>
*{box-sizing:border-box}
html,body{
  margin:0;padding:0;overflow-x:hidden;
  font-family:Arial,sans-serif;background:#111;color:#fff;
}
header{
  text-align:center;padding:10px;
  font-size:26px;font-weight:bold;
}
#time{text-align:center;font-size:17px;margin-top:4px;color:#ccc}
#status{text-align:center;font-size:14px;color:#ff6b6b;margin-top:6px;min-height:20px}
button{
  display:block;margin:10px auto;
  padding:8px 18px;font-size:17px;cursor:pointer;
}
.container{display:flex;width:100%;gap:4px;padding:4px}
.column{width:50%;background:#1a1a1a;padding:4px;border-radius:4px}
table{width:100%;border-collapse:collapse;font-size:16px;table-layout:fixed}
th,td{
  border:1px solid #444;
  padding:2px 0;
  text-align:center;
  white-space:nowrap;
  line-height:1.35;
}
th:nth-child(1),td:nth-child(1){width:38%}
th:nth-child(2),td:nth-child(2){width:20%}
th:nth-child(3),td:nth-child(3){width:20%}
th{background:#222}
h2{text-align:center;font-size:19px;margin:4px 0}
</style>
</head>

<body>
<header>ê²½ê¸°ë„ ì¥ì• ì¸ì½œ ëŒ€ê¸°í˜„í™©</header>
<button onclick="loadData()">ğŸ” ìƒˆë¡œê³ ì¹¨</button>
<div id="time"></div>
<div id="status"></div>

<div class="container">
<div class="column">
<h2>ì‹œêµ° ëª©ë¡ (1ì—´)</h2>
<table>
<thead><tr><th>ì‹œêµ°ëª…</th><th>ìš´í–‰</th><th>ëŒ€ê¸°</th></tr></thead>
<tbody id="leftList"></tbody>
</table>
</div>

<div class="column">
<h2>ì‹œêµ° ëª©ë¡ (2ì—´)</h2>
<table>
<thead><tr><th>ì‹œêµ°ëª…</th><th>ìš´í–‰</th><th>ëŒ€ê¸°</th></tr></thead>
<tbody id="rightList"></tbody>
</table>
</div>
</div>

<script>
const PRIORITY=[
"ì˜ì •ë¶€ì‹œ","ì–‘ì£¼ì‹œ","ë™ë‘ì²œì‹œ","í¬ì²œì‹œ",
"ë‚¨ì–‘ì£¼ì‹œ","ì—°ì²œêµ°","ê³ ì–‘ì‹œ","íŒŒì£¼ì‹œ"
];

function setStatus(msg){
  document.getElementById("status").innerText=msg||"";
}

function render(id,data){
  document.getElementById(id).innerHTML=data.map(r=>
  `<tr><td>${r.LNAME}</td><td>${r.CUR_VEHICLE}</td><td>${r.NUM_WAIT}</td></tr>`).join("");
}

async function loadData(){
  setStatus("");
  document.getElementById("leftList").innerHTML="<tr><td colspan='3'>ë¡œë”©ì¤‘...</td></tr>";
  document.getElementById("rightList").innerHTML="";

  try{
    const res=await fetch("/api/waitinfo",{cache:"no-store"});

    if(!res.ok){
      throw new Error("API ê²½ë¡œ ì˜¤ë¥˜ (/api/waitinfo ì¡´ì¬ í™•ì¸)");
    }

    const contentType=res.headers.get("content-type")||"";
    if(!contentType.includes("application/json")){
      throw new Error("JSON ì‘ë‹µ ì•„ë‹˜ â†’ /api/waitinfo.js í™•ì¸ í•„ìš”");
    }

    const data=await res.json();

    if(!data||data.RESCODE!=="0000"||!data.RESULT||!Array.isArray(data.RESULT.LIST)){
      throw new Error("ì‘ë‹µ ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜");
    }

    const list=data.RESULT.LIST;

    const fixed=list
      .filter(x=>PRIORITY.includes(x.LNAME))
      .sort((a,b)=>PRIORITY.indexOf(a.LNAME)-PRIORITY.indexOf(b.LNAME));

    const others=list
      .filter(x=>!PRIORITY.includes(x.LNAME))
      .sort((a,b)=>a.LNAME.localeCompare(b.LNAME,"ko"));

    const final=[...fixed,...others];
    const mid=Math.ceil(final.length/2);

    render("leftList",final.slice(0,mid));
    render("rightList",final.slice(mid));

    document.getElementById("time").innerText=
      "ì¡°íšŒ ì‹œê°: "+new Date().toLocaleString("ko-KR");

  }catch(err){
    setStatus(err.message);
    document.getElementById("leftList").innerHTML="<tr><td colspan='3'>ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</td></tr>";
  }
}

loadData();
</script>
</body>
</html>
